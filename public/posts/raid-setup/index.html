<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Setting up RAID1 array & migrating data. | dinhcap's blog</title>
<meta name=keywords content="data,raid"><meta name=description content="Setting up RAID1 in Linux for increased data reliability."><meta name=author content="dinhcap"><link rel=canonical href=https://dinhcap.dev/posts/raid-setup/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://dinhcap.dev/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://dinhcap.dev/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://dinhcap.dev/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://dinhcap.dev/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://dinhcap.dev/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="Setting up RAID1 array & migrating data."><meta property="og:description" content="Setting up RAID1 in Linux for increased data reliability."><meta property="og:type" content="article"><meta property="og:url" content="https://dinhcap.dev/posts/raid-setup/"><meta property="og:image" content="https://dinhcap.dev/hdd35.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-02-06T13:56:44+07:00"><meta property="article:modified_time" content="2024-02-06T13:56:44+07:00"><meta property="og:site_name" content="dinhcap's blog page"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://dinhcap.dev/hdd35.jpg"><meta name=twitter:title content="Setting up RAID1 array & migrating data."><meta name=twitter:description content="Setting up RAID1 in Linux for increased data reliability."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://dinhcap.dev/posts/"},{"@type":"ListItem","position":2,"name":"Setting up RAID1 array \u0026 migrating data.","item":"https://dinhcap.dev/posts/raid-setup/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Setting up RAID1 array \u0026 migrating data.","name":"Setting up RAID1 array \u0026 migrating data.","description":"Setting up RAID1 in Linux for increased data reliability.","keywords":["data","raid"],"articleBody":"I currently have two HDD drives of identical sizes (not identical in form factor and brand though), and since they are not used fully (\u003c50% storage remaining for both), I feel like it’s good to setup a RAID1 array for increased read speed and data reliability.\nTwo HDDs were used, and I’m on EndeavourOS Galileo for this.\nTransferring data \u0026 backing up. First, I move my data from the WD HDD to the other HDD using rsync:\n1 sudo rsync -av /hdd1/ /hdd2/hdd1/ This rsync command with -a option is commonly used for backup purposes, which is what we want here. It keeps all data intact, including permissions, ownerships, timestamps, etc.. to make sure that the data is identical.\nIf you’re not sure if your data is fully transferred or not, you can redo the rsync command, with the -c option (checksum checking) to make sure that the data is intact. rsync will compare the files and if some files are corrupted, it will redo the transferring again:\n1 sudo rsync -avc /hdd1/ /hdd2/hdd1/ Be warned that this will take a longer time, because it has to read all the files again, while also comparing checksums. On my HDD, it took around ~30 minutes for 50GB of data, which was substantially slower than the initial transfer, but your mileage may vary.\nAt the time of writing and setting this up, I wasn’t really sure whether setting up a RAID1 array with mdadm would actually delete my files on the drive or not. I couldn’t really find a definite answer, and the two drives contained my backup data, so I did not risk it and backed up the hdd2 drive to my root SSD. So it’s time to use the rsync command before - again.\n1 sudo rsync -a --info=progress2 /hdd2/ /ssd/hdd2/ Since I’m moving two drives worth of data here, I used --info=progress2 to see the current progress and transfer speed.\nThe initial transfer seems to be quick and fast (80% in 10 minutes!), but after redoing the math, i realized that wasn’t the case. As rsync scans for more files and verify them (this can be seen with ir-chk value in the rsync console), the percentage in the progress is going to decrease to reflect the real value. A popular answer from Stack Exchange explains this pretty well.\nAs the transfer is going to take nearly an hour, it’s time to do our posture check, glass of water and do the 20-20-20 rule for your eyes.\nAfter roughly half an hour the transfer succeeded:\n1 217.549.770.989 99% 103,44MB/s 0:33:25 (xfr#10283, to-chk=0/11070) Now it’s time to move on the next step: Setting up the RAID array!\nCreating the RAID array. These are plenty of guides when it comes to creating a RAID1 array, and I’m using two guides: One from the Linux Raid Wiki and one from the ArchWiki.\nFirst, Install the software RAID utility mdadm:\n1 sudo pacman -S mdadm Then, go into the root account:\n1 sudo su From here, we need to partition the drives. For the sake of simplicity, I’m going with GParted, mostly because I’m already using a DE and it makes thing much more easy to see. You can use the partitioner of your choice.\nMy HDDs are /dev/sda and /dev/sdc, and one is formatted in xfs and one is ext4. I prefer xfs, so I formatted the other ext4 partition via the GParted utility.\nNote: I later found out that this was not needed anyways, since all data is formatted after the RAID setup.\nNow it’s time to create the RAID1 array:\n1 mdadm --create --verbose --level=1 --metadata=1.2 --raid-devices=2 /dev/md/MyRAID1Array /dev/sdb1 /dev/sdc1 with the MyRAID1Array a name of your choice.\nHere in my case, GParted shows that both drives are successfully set up in a RAID1 array, with the mount point being the virtual device /dev/md127. However, it is not accessible yet, since the drives are resyncing and restoring parity:\n1 2 3 4 5 6 7 8 [dinhcap@endeavour:~] $ cat /proc/mdstat Personalities : [raid1] md127 : active raid1 sdc1[1] sda1[0] 488252416 blocks super 1.2 [2/2] [UU] [==\u003e..................] resync = 13.7% (67335936/488252416) finish=62.7min speed=111790K/sec bitmap: 4/4 pages [16KB], 65536KB chunk unused devices: This is going to take a long time.\nAfter more than an hour later (2 VALORANT matches), mdstat reports that it is completed:\n1 2 3 4 5 6 7 [dinhcap@endeavour:~] $ cat /proc/mdstat Personalities : [raid1] md127 : active raid1 sdc1[1] sda1[0] 488252416 blocks super 1.2 [2/2] [UU] bitmap: 0/4 pages [0KB], 65536KB chunk unused devices: And then the rest is basically followed like ArchWiki:\nUpdate configuration file:\n1 mdadm --detail --scan \u003e\u003e /etc/mdadm.conf Assemble the array:\n1 mdadm --assemble --scan Now, with all that steps done, I can finally format my md127 virtual device to xfs!\nIt was late at night and I had school the day after, so I decided it’s time to sleep and turned off the machine. The following day, on booting up the device, I was greeted with a failure to boot (emergency mode) and a device dependency (something, couldn’t remember it) error! Though, I totally expected this as this has happened to me before.\nThe reason is that /etc/fstab is not updated, leading to the kernel trying to find a nonexistent drive from the previous setup. I only need to add an entry to the /etc/fstab and things should be working as normal.\n1 2 root@endeavour dinhcap]# blkid /dev/md127p1: UUID=\"e4fa4703-ecd0-4899-9a9e-0b62c6f95ee4\" BLOCK_SIZE=\"4096\" TYPE=\"xfs\" PARTUUID=\"66e841e2-3ede-4712-8261-480cbd1bcfe1\" From here, I can note down the UUID of the device and mount it with fstab by adding an entry to /etc/fstab:\n1 UUID=e4fa4703-ecd0-4899-9a9e-0b62c6f95ee4 /media/dinhcap/raidhdd xfs defaults,noatime 0 0 and also commenting out the two drives that were mounted from the previous setup:\n1 2 # UUID=776a6cd5-5718-4b96-add2-42734cf43cbb /media/dinhcap/25hdd xfs defaults,noatime 0 0 # UUID=ffdbf901-fae6-d901-60c9-f901fae6d901 /media/dinhcap/hdd ext4 defaults,noatime 0 0 After rebooting, the machine boots straight into the OS with flying colors!\nTransferring the data. After finishing setup the drive and mounting it, it’s time to transfer the data back, again, with rsync. But first, I have to take ownership of the drive with chown:\n1 sudo chown dinhcap:dinhcap -R ./raidhdd with ls -al, I can tell if the change took place or not:\n1 drwxr-xr-x 2 dinhcap dinhcap 6 00:20 6 Thg 2 raidhdd Success!\nNow I want to store the files to two different folders respective to the two drives directories I had before with rsync, and things should be done!\nSince I’ve migrated my files in separate folder, now is the fun part: Creating symbolic links!\n1 sudo ln -s /old/dir/ /sym/dir/ Symbolic links are basically shortcuts in Windows, that points the symlink to the specified directory. By doing this, I don’t have to look through every single configurations of each app and change things, as it will still point into the correct folder. Backwards compatibility ftw!\nConclusion. This is the process that I’ve done to migrate my data from two HDDs and create a RAID1 array for my home server. I’ve done some unnecessary steps during the migration (not mentioned here), but I’m happy with how things turned out. I now have a more reliable backup to work with, eliminating single point of failure in my data drive.\n","wordCount":"1202","inLanguage":"en","image":"https://dinhcap.dev/hdd35.jpg","datePublished":"2024-02-06T13:56:44+07:00","dateModified":"2024-02-06T13:56:44+07:00","author":{"@type":"Person","name":"dinhcap"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://dinhcap.dev/posts/raid-setup/"},"publisher":{"@type":"Organization","name":"dinhcap's blog","logo":{"@type":"ImageObject","url":"https://dinhcap.dev/%3Clink%20/%20abs%20url%3E"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://dinhcap.dev/ accesskey=h title="Home (Alt + H)"><img src=https://dinhcap.dev/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://dinhcap.dev/posts/ title=Posts><span>Posts</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://dinhcap.dev/>Home</a>&nbsp;»&nbsp;<a href=https://dinhcap.dev/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Setting up RAID1 array & migrating data.</h1><div class=post-description>Setting up RAID1 in Linux for increased data reliability.</div><div class=post-meta><span title='2024-02-06 13:56:44 +0700 +07'>6 February, 2024</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;1202 words&nbsp;·&nbsp;dinhcap&nbsp;|&nbsp;<a href=https://github.com/dng-nguyn/-repo-/content/posts/raid-setup.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#transferring-data--backing-up aria-label="Transferring data & backing up.">Transferring data & backing up.</a></li><li><a href=#creating-the-raid-array aria-label="Creating the RAID array.">Creating the RAID array.</a></li><li><a href=#transferring-the-data aria-label="Transferring the data.">Transferring the data.</a></li><li><a href=#conclusion aria-label=Conclusion.>Conclusion.</a></li></ul></div></details></div><div class=post-content><p>I currently have two HDD drives of identical sizes (not identical in form factor and brand though), and since they are not used fully (&lt;50% storage remaining for both), I feel like it&rsquo;s good to setup a RAID1 array for increased read speed and data reliability.</p><p>Two HDDs were used, and I&rsquo;m on EndeavourOS Galileo for this.</p><h2 id=transferring-data--backing-up>Transferring data & backing up.<a hidden class=anchor aria-hidden=true href=#transferring-data--backing-up>#</a></h2><p>First, I move my data from the WD HDD to the other HDD using <code>rsync</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo rsync -av /hdd1/ /hdd2/hdd1/
</span></span></code></pre></td></tr></table></div></div><p>This rsync command with <code>-a</code> option is commonly used for backup purposes, which is what we want here. It keeps all data intact, including permissions, ownerships, timestamps, etc.. to make sure that the data is identical.</p><p>If you&rsquo;re not sure if your data is fully transferred or not, you can redo the <code>rsync</code> command, with the <code>-c</code> option (checksum checking) to make sure that the data is intact. <code>rsync</code> will compare the files and if some files are corrupted, it will redo the transferring again:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo rsync -avc /hdd1/ /hdd2/hdd1/
</span></span></code></pre></td></tr></table></div></div><p>Be warned that this will take a longer time, because it has to read all the files again, while also comparing checksums. On my HDD, it took around ~30 minutes for 50GB of data, which was substantially slower than the initial transfer, but your mileage may vary.</p><p>At the time of writing and setting this up, I wasn&rsquo;t really sure whether setting up a RAID1 array with <code>mdadm</code> would actually delete my files on the drive or not. I couldn&rsquo;t really find a definite answer, and the two drives contained my backup data, so I did not risk it and backed up the hdd2 drive to my root SSD. So it&rsquo;s time to use the <code>rsync</code> command before - again.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo rsync -a --info<span class=o>=</span>progress2 /hdd2/ /ssd/hdd2/
</span></span></code></pre></td></tr></table></div></div><p>Since I&rsquo;m moving two drives worth of data here, I used <code>--info=progress2</code> to see the current progress and transfer speed.</p><p>The initial transfer seems to be quick and fast (80% in 10 minutes!), but after redoing the math, i realized that wasn&rsquo;t the case. As rsync scans for more files and verify them (this can be seen with <code>ir-chk</code> value in the rsync console), the percentage in the progress is going to decrease to reflect the real value. <a href=https://unix.stackexchange.com/a/261139>A popular answer from Stack Exchange</a> explains this pretty well.</p><p>As the transfer is going to take nearly an hour, it&rsquo;s time to do our posture check, glass of water and do the 20-20-20 rule for your eyes.</p><p>After roughly half an hour the transfer succeeded:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>217.549.770.989 99% 103,44MB/s 0:33:25 <span class=o>(</span>xfr#10283, to-chk<span class=o>=</span>0/11070<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Now it&rsquo;s time to move on the next step: Setting up the RAID array!</p><h2 id=creating-the-raid-array>Creating the RAID array.<a hidden class=anchor aria-hidden=true href=#creating-the-raid-array>#</a></h2><p>These are plenty of guides when it comes to creating a RAID1 array, and I&rsquo;m using two guides: One from the <a href=https://web.archive.org/web/20240205122020/https://raid.wiki.kernel.org/index.php/RAID_setup>Linux Raid Wiki</a> and one from the <a href=https://web.archive.org/web/20240205122114/https://wiki.archlinux.org/title/RAID>ArchWiki</a>.</p><p>First, Install the software RAID utility <code>mdadm</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo pacman -S mdadm
</span></span></code></pre></td></tr></table></div></div><p>Then, go into the root account:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo su
</span></span></code></pre></td></tr></table></div></div><p>From here, we need to partition the drives. For the sake of simplicity, I&rsquo;m going with GParted, mostly because I&rsquo;m already using a DE and it makes thing much more easy to see. You can use the partitioner of your choice.</p><p>My HDDs are /dev/sda and /dev/sdc, and one is formatted in xfs and one is ext4. I prefer xfs, so I formatted the other ext4 partition via the GParted utility.</p><p><img loading=lazy src=success.png alt="Successful partition!"></p><p><em>Note: I later found out that this was not needed anyways, since all data is formatted after the RAID setup.</em></p><p>Now it&rsquo;s time to create the RAID1 array:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mdadm --create --verbose --level<span class=o>=</span><span class=m>1</span> --metadata<span class=o>=</span>1.2 --raid-devices<span class=o>=</span><span class=m>2</span> /dev/md/MyRAID1Array /dev/sdb1 /dev/sdc1
</span></span></code></pre></td></tr></table></div></div><p>with the <code>MyRAID1Array</code> a name of your choice.</p><p><img loading=lazy src=hdd-info.png alt="HDD information in GParted"></p><p>Here in my case, GParted shows that both drives are successfully set up in a RAID1 array, with the mount point
being the virtual device <code>/dev/md127</code>. However, it is not accessible yet, since the drives are resyncing and restoring parity:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1>1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2>2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3>3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4>4</a>
</span><span class=lnt id=hl-7-5><a class=lnlinks href=#hl-7-5>5</a>
</span><span class=lnt id=hl-7-6><a class=lnlinks href=#hl-7-6>6</a>
</span><span class=lnt id=hl-7-7><a class=lnlinks href=#hl-7-7>7</a>
</span><span class=lnt id=hl-7-8><a class=lnlinks href=#hl-7-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>dinhcap@endeavour:~<span class=o>]</span> $ cat /proc/mdstat
</span></span><span class=line><span class=cl>Personalities : <span class=o>[</span>raid1<span class=o>]</span>
</span></span><span class=line><span class=cl>md127 : active raid1 sdc1<span class=o>[</span>1<span class=o>]</span> sda1<span class=o>[</span>0<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=m>488252416</span> blocks super 1.2 <span class=o>[</span>2/2<span class=o>]</span> <span class=o>[</span>UU<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>[==</span>&gt;..................<span class=o>]</span> <span class=nv>resync</span> <span class=o>=</span> 13.7% <span class=o>(</span>67335936/488252416<span class=o>)</span> <span class=nv>finish</span><span class=o>=</span>62.7min <span class=nv>speed</span><span class=o>=</span>111790K/sec
</span></span><span class=line><span class=cl>bitmap: 4/4 pages <span class=o>[</span>16KB<span class=o>]</span>, 65536KB chunk
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>unused devices: &lt;none&gt;
</span></span></code></pre></td></tr></table></div></div><p>This is going to take a long time.</p><p>After more than an hour later (2 VALORANT matches), <code>mdstat</code> reports that it is completed:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1>1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2>2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3>3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4>4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5>5</a>
</span><span class=lnt id=hl-8-6><a class=lnlinks href=#hl-8-6>6</a>
</span><span class=lnt id=hl-8-7><a class=lnlinks href=#hl-8-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>dinhcap@endeavour:~<span class=o>]</span> $ cat /proc/mdstat
</span></span><span class=line><span class=cl>Personalities : <span class=o>[</span>raid1<span class=o>]</span>
</span></span><span class=line><span class=cl>md127 : active raid1 sdc1<span class=o>[</span>1<span class=o>]</span> sda1<span class=o>[</span>0<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=m>488252416</span> blocks super 1.2 <span class=o>[</span>2/2<span class=o>]</span> <span class=o>[</span>UU<span class=o>]</span>
</span></span><span class=line><span class=cl>bitmap: 0/4 pages <span class=o>[</span>0KB<span class=o>]</span>, 65536KB chunk
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>unused devices: &lt;none&gt;
</span></span></code></pre></td></tr></table></div></div><p>And then the rest is basically followed like ArchWiki:</p><p>Update configuration file:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mdadm --detail --scan &gt;&gt; /etc/mdadm.conf
</span></span></code></pre></td></tr></table></div></div><p>Assemble the array:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mdadm --assemble --scan
</span></span></code></pre></td></tr></table></div></div><p>Now, with all that steps done, I can finally format my <code>md127</code> virtual device to xfs!</p><p><img loading=lazy src=format-success.png alt=Success!></p><p>It was late at night and I had school the day after, so I decided it&rsquo;s time to sleep and turned off the machine. The following day, on booting up the device, I was greeted with a failure to boot (emergency mode) and a device dependency (something, couldn&rsquo;t remember it) error! Though, I totally expected this as this has happened to me before.</p><p>The reason is that <code>/etc/fstab</code> is not updated, leading to the kernel trying to find a nonexistent drive from the previous setup. I only need to add an entry to the <code>/etc/fstab</code> and things should be working as normal.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1>1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@endeavour dinhcap<span class=o>]</span><span class=c1># blkid</span>
</span></span><span class=line><span class=cl>/dev/md127p1: <span class=nv>UUID</span><span class=o>=</span><span class=s2>&#34;e4fa4703-ecd0-4899-9a9e-0b62c6f95ee4&#34;</span> <span class=nv>BLOCK_SIZE</span><span class=o>=</span><span class=s2>&#34;4096&#34;</span> <span class=nv>TYPE</span><span class=o>=</span><span class=s2>&#34;xfs&#34;</span> <span class=nv>PARTUUID</span><span class=o>=</span><span class=s2>&#34;66e841e2-3ede-4712-8261-480cbd1bcfe1&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>From here, I can note down the UUID of the device and mount it with fstab by adding an entry to <code>/etc/fstab</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>UUID</span><span class=o>=</span>e4fa4703-ecd0-4899-9a9e-0b62c6f95ee4 /media/dinhcap/raidhdd xfs defaults,noatime <span class=m>0</span> <span class=m>0</span>
</span></span></code></pre></td></tr></table></div></div><p>and also commenting out the two drives that were mounted from the previous setup:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1>1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># UUID=776a6cd5-5718-4b96-add2-42734cf43cbb     /media/dinhcap/25hdd    xfs    defaults,noatime        0       0</span>
</span></span><span class=line><span class=cl><span class=c1># UUID=ffdbf901-fae6-d901-60c9-f901fae6d901     /media/dinhcap/hdd      ext4    defaults,noatime        0       0</span>
</span></span></code></pre></td></tr></table></div></div><p>After rebooting, the machine boots straight into the OS with flying colors!</p><h2 id=transferring-the-data>Transferring the data.<a hidden class=anchor aria-hidden=true href=#transferring-the-data>#</a></h2><p>After finishing setup the drive and mounting it, it&rsquo;s time to transfer the data back, again, with <code>rsync</code>. But first, I have to take ownership of the drive with <code>chown</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo chown dinhcap:dinhcap -R ./raidhdd
</span></span></code></pre></td></tr></table></div></div><p>with <code>ls -al</code>, I can tell if the change took place or not:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>drwxr-xr-x 2 dinhcap dinhcap   6 00:20  6 Thg 2  raidhdd
</span></span></code></pre></td></tr></table></div></div><p>Success!</p><p>Now I want to store the files to two different folders respective to the two drives directories I had before with <code>rsync</code>, and things should be done!</p><p>Since I&rsquo;ve migrated my files in separate folder, now is the fun part: Creating symbolic links!</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo ln -s /old/dir/ /sym/dir/
</span></span></code></pre></td></tr></table></div></div><p>Symbolic links are basically shortcuts in Windows, that points the symlink to the specified directory. By doing this, I don&rsquo;t have to look through every single configurations of each app and change things, as it will still point into the correct folder. Backwards compatibility ftw!</p><h2 id=conclusion>Conclusion.<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>This is the process that I&rsquo;ve done to migrate my data from two HDDs and create a RAID1 array for my home server. I&rsquo;ve done some unnecessary steps during the migration (not mentioned here), but I&rsquo;m happy with how things turned out. I now have a more reliable backup to work with, eliminating single point of failure in my data drive.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://dinhcap.dev/tags/data/>data</a></li><li><a href=https://dinhcap.dev/tags/raid/>raid</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://dinhcap.dev/>dinhcap's blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>